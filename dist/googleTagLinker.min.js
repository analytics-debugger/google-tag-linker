/*!
* 
*   @analytics-debugger/google-tag-linker 0.0.1
*   https://github.com/analytics-debugger/google-tag-linker
*
*   Copyright (c) David Vallejo (https://www.thyngster.com).
*   This source code is licensed under the MIT license found in the
*   LICENSE file in the root directory of this source tree.
*
*/

!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).googleTagLinker=r()}(this,(function(){"use strict";function e(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var t=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function n(e){for(var r=("; "+document.cookie).split("; "),t=r.length-1;t>=0;t--){var n=r[t].split("=");if(e instanceof RegExp?e.test(n[0]):e===n[0])return[n[0],n[1]]}return[]}function i(e,r){return[e,window.btoa(r).replace(/=/g,".")].join("*")}function o(e){return window.atob(e.replace(/\./g,"="))}function a(e){var r=window.location.href,t=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(r);return null===t?null:decodeURIComponent(t[1])}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.linkerQueryParameterName,t=e.checkFingerPrint,n=a(r);if(n){for(var i=n.split("*").slice(2),s={},u=[],c=0;c<i.length;c+=2){var f=i[c],g=i[c+1];u.push(f+"*"+g),s[f]=o(g)}if(t){var m=l(u),d=n.split("*")[1];if(d!==m)return}return s}}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.cookiesNamesList,t=[],o=void 0;return r.forEach((function(e){var r=n(e);e=r[0];var a=r[1];a&&(/^_ga/.test(e)?a=a.match(/G[A-Z]1\.[0-9]\.(.+)/)[1]:"FPLC"===e&&(o=a),t.push(i(e,a)))})),o&&t.push(i("_fplc",o)),t}function c(e,r,n,i){if(n&&n.href){var o=r=g(e,r,n.href,i);t.test(o)&&(n.href=o)}}function f(e,r,n){if(n&&n.action){var i=(n.method||"").toLowerCase();if("get"===i){for(var o=n.childNodes||[],a=!1,s=0;s<o.length;s++){var u=o[s];if(u.name===e){u.setAttribute("value",r),a=!0;break}}if(!a){var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name",e),c.setAttribute("value",r),n.appendChild(c)}}else if("post"===i){var f=g(e,r,n.action);t.test(f)&&(n.action=f)}}}function g(e,r,t,n){function i(r){var t=(r=function(e,r){if(e=function(e){return new RegExp("(.*?)(^|&)"+e+"=([^&]*)&?(.*)")}(e).exec(r)){var t=e[2],n=e[4];r=e[1],n&&(r=r+t+n)}return r}(e,r)).charAt(r.length-1);return r&&"&"!==t&&(r+="&"),r+c}n=!!n;var o=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(t);if(!o)return"";var a=o[1],s=o[2]||"",u=o[3]||"",c=e+"="+r;return n?u="#"+i(u.substring(1)):s="?"+i(s.substring(1)),""+a+s+u}function l(){for(var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=[window.navigator.userAgent,(new Date).getTimezoneOffset(),window.navigator.userLanguage||window.navigator.language,Math.floor((new Date).getTime()/60/1e3)-0,r?r.join("*"):""].join("*"),n=[],i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;n[i]=e}for(var a=-1,s=0;s<t.length;s++)a=a>>>8^n[255&(a^t.charCodeAt(s))];return((-1^a)>>>0).toString(36)}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.cookiesNamesList,t=u({cookiesNamesList:r});return["1",l(t),t.join("*")].join("*")}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.linkerQueryParameterName;e.cookiesNamesList;var t=e.checkFingerPrint;return s({linkerQueryParameterName:r,checkFingerPrint:t})}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.linkerQueryParameterName,t=e.cookiesNamesList,n=e.entity,i=e.useFragment,o=m({cookiesNamesList:t});if(n.tagName){if("A"===n.tagName)return c(r,o,n,i);if("FORM"===n.tagName)return f(r,o,n)}if("string"==typeof n)return g(r,o,n,i)}var h=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"get",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"==typeof window||void 0===window.document)throw"This should be only run on a browser";var n={gaCookiesPrefix:t.gaCookiesPrefix||"",conversionLinkerCookiesPrefix:t.conversionLinkerCookiesPrefix||"_gcl",linkerQueryParameterName:t.linkerQueryParameterName||"_gl",checkFingerPrint:t.checkFingerPrint||!1,useFragment:t.useFragment||!1};switch(t.cookiesNamesList?n.cookiesNamesList=t.cookiesNamesList:(n.cookiesNamesList=[n.gaCookiesPrefix+"_ga",new RegExp("^"+n.gaCookiesPrefix+"_ga_[A-Z,0-9]"),"FPLC"],["_aw","_dc","_gb","_gf","_ha"].forEach((function(e){n.cookiesNamesList.push(n.conversionLinkerCookiesPrefix+e)}))),n.cookiesNamesList=t.cookiesNamesList?t.cookiesNamesList:[n.gaCookiesPrefix+"_ga",new RegExp("^"+n.gaCookiesPrefix+"_ga_[A-Z,0-9]")].concat(e(["_aw","_dc","_gb","_gf","_ha"].map((function(e){return n.conversionLinkerCookiesPrefix+e}))),["FPLC"]),r){case"get":return m({cookiesNamesList:n.cookiesNamesList});case"read":return d({linkerQueryParameterName:n.linkerQueryParameterName,checkFingerPrint:n.checkFingerPrint});case"decorate":return v({linkerQueryParameterName:n.linkerQueryParameterName,cookiesNamesList:n.cookiesNamesList,entity:t.entity,useFragment:n.useFragment})}};return h.prototype={},h.answer=42,h}));
